# 事件分析

事件，是指用户在 APP、网站等应用上发生的行为，即何人，何时，何地，通过何种方式，做了什么事。

事件分析模型主要用于分析用户在应用上的行为，比如打开 APP、注册、登录、支付订单等。通过触发用户数、触发次数、访问时长等基础指标度量用户行为，同时也支持指标的运算构建复杂的指标衡量业务过程。

## 事件分析能解决哪些问题？

1. 如何监测产品每天的用户数、访问次数、使用时长？趋势是否发生了变化？引起变化的因素有哪些？
2. 上周选择了多个渠道对 APP 进行了推广，各个渠道带来的用户注册量如何？变化趋势是什么样？
3. 北京地区的用户和上海地区的用户，购买家电品类的金额分布差异在哪里？
4. 今天在产品中发起了一个话题，各个时段用户的参与情况如何？
5. 最近半年付费用户数和 ARPU 值是多少？

## 功能说明

![image](https://imguserradar.analysys.cn/fangzhou/img/2018/08/201808141246577875.png)

### 1. 定义指标区

左侧为指标定义区域，选择要分析的指标，细分维度查看，支持条件过滤，观察指标表现

![img](https://imguserradar.analysys.cn/fangzhou/img/2018/08/201808141251267255.png)

#### 1.1 选择分析粒度

支持 **事件** 和 **Session** 两个分析粒度，Session 的使用说明详见[《Session 分析》](./analytics-session.md)。

#### 1.2 选择指标

从下拉框中选择指标，指标有**事件相关指标**和**自定义指标**两大类型：

##### 1.2.1 事件相关指标

**有两种组成结构**

A. 事件 - 事件支持的指标，例如 提交订单的触发用户数，表示有多少人点击了提交订单；

B. 事件 - 事件的属性 - 属性值支持的指标，例如 提交订单的优惠券金额的总和，表示提交订单时总共使用了多少优惠券。

![image](https://imguserradar.analysys.cn/fangzhou/img/2018/08/201808141233299337.png)

**对所有事件都支持计算的指标：**

* 触发用户数：触发选定事件的去重用户数，例如加入购物车的触发用户数
* 触发次数：触发选定事件的总次数，例如加入购物车的触发次数
* 人均触发次数： 平均每个用户触发选定事件的次数，例如加入购物车的人均触发次数

**属性值以下五种类型，不同类型支持计算的指标有差异：**

* 字符串
* 数值型
* 布尔值
* 日期时间
* 字符串集合

> 注意：在集成 SDK 时，不同类型的属性值需要满足不同的数据格式，才能在分析时正确使用，详见《[SDK指南》](./integration-data-type.md)。

**对所有属性值类型的属性都支持计算的指标：**

* 去重数：在选定时间范围内，该属性出现的独立去重个数，例如加入购物车商品的数量

**对数值型属性值的属性支持计算的指标：**

* 总和：选定属性的属性值求和，例如加入购物车的商品金额之和
* 均值：选定属性的属性值算数平均数，例如加入购物车的商品金额均值
* 最大值：选定属性的属性值最大值，例如加入购物车的商品最大金额
* 最小值：选定属性的属性值最小值，例如加入购物车的商品最小金额
* 人均值：选定属性的属性值人均值，例如人均加入购物车的商品金额

##### 1.2.2 自定义指标

除了事件相关指标外，方舟支持自定义指标公式，构建无法通过选择事件得出的指标，比如 ARPU、ROI 等。

![img](https://imguserradar.analysys.cn/fangzhou/img/2018/08/201808141259581787.png)

**如何定义？**

1. 输入公式，支持选择的指标、常数之间的加、减、乘、除四则运算
2. 命名指标
3. 选择指标结果值的数值类型：整数、两位小数和百分数
4. 添加指标单位
5. 保存

当选择保存并开始计算时，会自动计算结果并展示；当选择仅保存时，会保存在下拉框中，后续分析时可选择。

定义完成后，下次就可以从下拉框中已保存的指标中快速选择；如果需要修改指标定义的话，可以选择下拉框中又上角的管理功能进行编辑。

![img](https://imguserradar.analysys.cn/fangzhou/img/2018/08/201808141308391637.gif)

#### 1.3 细分维度

**维度**指分析事物的角度。例如，分析活跃用户，可以从时间的维度，也可以从地域的维度去看，也可以时间、地域两个维度组合去分析。

有层次关系的维度，就可以根据分析需求改变维的层次，变换分析的粒度钻取，比如从地域这个维度类型上，可以细分到省份、城市、县、乡镇的用户，也可以向上汇总。

维度也可以分为定性维度和定量维度（根据数据类型划分）。数据类型为字符型即定性维度，如城市、性别等；数据类型为数值型数据的即定量维度，如收入、年龄、消费金额等，定量维度一般需要数值分组处理，例如年龄划分为 20 岁以下，20~29 岁，30~39 岁等，更多类型如下：

| 数据类型 | 维度处理方式                                                 | 举例属性                                                     | 查询用户数，按举例维度细分                                   |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 字符串   | 按离散值                                                     | 商品类别<br>上报的属性值：<br>3C电器、服装、化妆品……         | 3C电器：12人<br>服装：12人<br>化妆品：18人                   |
| 数值型   | 按离散值<br>自定义区间分组                                   | 商品价格<br>上报的属性：<br>12、20、90、300……                | 按离散值：<br>12：2人<br>20：3人<br>90：13人<br>300：1人<br>按用户自定义区间的话可能是：<br>(-∞,50)：5人<br>[50,200)：13人<br>[200,+∞]：1人 |
| 布尔值   | 按离散值                                                     | 是否使用优惠券<br>上报的属性值：<br>true、false              | 使用了优惠券的：12人<br>没有使用优惠券的：18人               |
| 日期时间 | 按分钟、小时、日、周、月、季、年<br>按时段汇总：按分钟、小时、日、周，月 | 下单时间<br>上报的属性值：<br>2017-03-12 12:12:32、<br>2018-03-15 12:12:32、<br>2018-04-12 12:12:32…… | 不按时段汇总，按月：<br>2017年3月：23人<br>2018年3月：27人<br>2018年4月：12人<br>按时段汇总，按月：<br>每年3月：50人<br>每年4月：12人 |
| 集合     | 按单个字符串的离散值| 用户爱好<br>上报的属性值：<br>[网球，摄影]、[户外，摄影]、[户外、壁球]…… | [网球，摄影]：34人<br>[户外，摄影]：53人<br>[户外、壁球]：23人 |

**单个指标时**，支持细分的维度，包括事件自定义属性、事件通用属性、用户属性。

**多个指标时**，支持细分的维度，包括公共的属性、事件通用属性、用户属性。

维度选择下拉框中，**数值型**和 **日期时间型**的维度有特殊标识，点击可以进行设置：

**A. 数值型维度分组方法**

![image](https://imguserradar.analysys.cn/fangzhou/img/2018/08/201808141312149728.png)

**B.日期型维度分组方法**

![image](https://imguserradar.analysys.cn/fangzhou/img/2018/08/201808141314187001.png)

#### 1.4 增加过滤条件

对于单个事件可以添加条件限制，也可以添加公共过滤条件，约束多个指标

![img](https://imguserradar.analysys.cn/fangzhou/img/2018/08/201808141319037437.png)

条件按照 **属性 - 运算符 - 属性值** 的结构构成，属性包括**事件自定义属性**、**通用属性**、**用户属性**三种类型。

不同的属性值的数据类型支持不同的操作符：

**A. 字符串**

| 操作符            | 使用场景                                                     | e.g.                                                      |
| ----------------- | ------------------------------------------------------------ | --------------------------------------------------------- |
| =(等于)           | 当输入一个值时，表示等于某个具体确定的属性值；当输入多个时，表示满足其中的一项或多项 | 设备品牌 = 苹果；设备品牌   满足 苹果、小米中的任意一个   |
| ≠（不等于）       | 完全排除输入的某个或多个属性值                               | 设备品牌 ≠ 苹果；设备品牌   不满足 苹果、小米中的任何一个 |
| like（包含）      | 查找属性值中包含某些字符的值                                 | 设备品牌 中 包含 苹果   这个词的                          |
| notlike（不包含） | 排除属性值中包含某些字符的值                                 | 设备品牌中 不包含 苹果   这个词的                         |
| 有值              | 查找有属性值的数据                                           | 有设备品牌名称的                                          |
| 无值              | 查找无属性值的数据                                           | 无设备品牌名称的                                          |

> 注：对于包含字典属性，目前不支持 like（模糊匹配）和 notlike（不匹配）。

**B. 数值型**

操作符 |使用场景| 例如
---|------|---
=（等于） |等于某个具体数字| 商品金额 = 100
≠（不等于）|不等于某个数字| 商品金额 ≠ 100
<（小于）| 小于某个数字| 商品金额 < 100
≤（小于等于）| 小于等于某个数字 |商品金额 ≤ 100
>（大于） |大于某个数字 |商品金额 ＞ 100
≥（大于等于）| 大于等于某个数字 |商品金额 ≥ 100
介于区间 |在某个数据区间内的数值| 100＜商品金额 ≤ 500
有值 |所有数字|任意商品金额
无值 |所有空白项|无商品金额

> 注：对于区间，支持自定义开区间还是闭区间

**C. 布尔值**

| 操作符 | 使用场景           | e.g.          |
| ------ | ------------------ | ------------- |
| 为真   | 某个判断为真       | 是否成功 = 是 |
| 为假   | 某个判断为假       | 是否成功 = 否 |
| 有值   | 查找有属性值的数据 | 有值          |
| 无值   | 查找无属性值的数据 | 无值          |

**D. 日期时间**

| 操作符           | 使用场景                   | e.g.                        |
| ---------------- | -------------------------- | --------------------------- |
| 绝对时间         | 在某个具体的时间范围       | 在 2018/12/14-   2018/12/17 |
| 相对当前时间点   | 在相对当前的某段时间里     | 在近 30 天内                |
| 相对事件发生时间 | 在相对事件发生的某段时间里 | 登录之前的 5 分钟里         |
| 有值             | 查找有属性值的数据         | 有日期                      |
| 无值             | 查找无属性值的数据         | 无日期                      |

> 注：当前的选项中，近7天、30天、90天，不包括查询当日，后续迭代中会扩展到当日

**E. 字符串集合**

| 操作符            | 使用场景                 | 例如                        |
| ----------------- | ------------------------ | --------------------------- |
| like（包含）      | 集合中包含某个字符的值   | 用户标签   包含 摄影 字段   |
| notlike（不包含） | 集合中不包含某个字符的值 | 用户标签   不包含 摄影 字段 |
| 有值              | 查找有属性值的数据       | 有用户标签                  |
| 无值              | 查找无属性值的数据       | 无用户标签                  |

### 2. 选择对比分群区

方舟支持在某个细分分群下查看指标，也支持多个分群对比

![img](https://imguserradar.analysys.cn/fangzhou/img/2018/08/201808141358027265.png)

### 3. 图表展示区

图表展示区，可以选择时间范围，时间粒度，图表样式

#### 3.1 时间范围

![image](https://imguserradar.analysys.cn/fangzhou/img/2019/01/201901161431373849.jpg)

可以选择近30日、今日、上周等常用范围，也可以在右侧自定义开始时间和结束时间。

当选择的是相对时间保存图表后，以后查询时会展示动态的时间范围。

例如今天是3月16日，选择查询近7日，查询结果是3月9日至3月15日的数据；在3月21日打开保存的该图表时，查看到的数据将是3月14日至3月20日。

当选择对比日期时，可以对比上一时段、去年同期、自定义对比指标表现
>**对比上一时段**：从选择时间范围向后移动相同天数的时间范围，比如当前选择的是1月9日-1月15日，选择了对比上一时间，则对比的是1月2日-1月8日，即可以分别对比1月9日与1月2日，1月10日与1月3日……的指标差异 <br>
>**对比去年同期**：对比当前时间段与去年同期的时间段，比如当前选择的是2019年1月9日-1月15日，选择了对比上一时间，则对比的是2018年1月9日-1月15日，即可以分别对比2019年1月9日与2018年1月9日，2019年1月10日与2018年1月10日……的指标差异<br>
>**自定义对比**：自定义时间范围，比如当前选择的是1月9日-1月15日，自定义对比1月8日-1月14日，即可分别对比1月9日与1月8日，1月10日与1月9日……的指标差异

#### 2.2 时间粒度

可选择的时间粒度，包括

时间粒度 |说明
---|------
按合计 |可以查看选定时间范围内的汇总
按分钟| 按分钟聚合，实时计算
按小时| 按小时聚合，实时计算
按日| 默认按照从 00:00:00 到 23:59:59 的完整日聚合，当时间范围中包含今日时，最多延迟几分钟
按周| 默认周一到周日的自然周聚合，当时间范围不足自然周时，计算的是选择范围内所在周若干天的聚合
按月| 当时间范围不足自然月时，计算的是选择范围内所在月若干天的聚合

#### 2.3 图表样式

展示不同的指标、条件、人群、维度组合查询结果，展示样式包括线形图、柱状图、堆积图和数据表格，以下将举例说明：

**A. 不同版本的活跃用户趋势**

在细分维度中，选择版本后，就可以查到各个版本的活跃用户数量，选择柱状堆叠图展示

![image](https://imguserradar.analysys.cn/fangzhou/img/2018/08/201808111740019031.png)

**B. 不同渠道的用户购买理财产品的金额**

选择表格展示

![image](https://imguserradar.analysys.cn/fangzhou/img/2018/08/201808111746142403.png)

### 4. 其他功能

其他保存、下载共享、抽样计算、强制刷新等等所有分析模型通用功能，详见[《分析》](./analytics.md)。

## 常见问题

### 在事件分析中查询得到的注册成功用户数为什么与用户数据库中查询到的结果不一致？
客户端数据上报会因为**网络环境等特殊原因**导致数据不能100%发送到方舟。方舟采取了很多手段来减少这种误差。但对于关键业务数据，我们依然建议您可以进行服务端上报。采用与您自身数据库所处网络类似的网络环境可以极大避免重要数据差异。

下面是我们建议通过服务端上报的数据：
* 注册成功时的用户信息
* 购买成功时的订单信息
* 支付成功信息

{% include "./partials/contacts.md" %}
