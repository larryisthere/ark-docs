# OAuth2.0ç™»å½•

æ–¹èˆŸä» 5.0 ç‰ˆæœ¬å¼€å§‹é›†æˆäº† OAuth2.0 æˆæƒç™»å½•è®¤è¯ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š

1. ç”¨æˆ·æ‰“å¼€æ–¹èˆŸç³»ç»Ÿçš„ç™»å½•é¡µé¢ï¼Œç‚¹å‡» â€œOAuth ç™»å½•â€ æŒ‰é’®ï¼ˆä»…é…ç½®åæ‰æœ‰è¯¥æŒ‰é’®ï¼‰ï¼Œæµè§ˆå™¨ä¼šè·³è½¬åˆ°é…ç½®çš„ç™»å½•é¡µé¢ï¼ˆOAuth2.0 è®¤è¯æœåŠ¡ç«¯æä¾›çš„ç™»å½•é¡µé¢ï¼‰
2. ç”¨æˆ·åœ¨è®¤è¯æœåŠ¡ç«¯ä¸Šå®Œæˆç™»å½•è®¤è¯åï¼ˆé¦–æ¬¡å°†è¯·æ±‚ç”¨æˆ·æˆæƒæ–¹èˆŸè·å–å¿…è¦çš„ç”¨æˆ·èµ„æ–™ï¼‰ï¼Œå®Œæˆæˆæƒåå°†è·³è½¬å›æ–¹èˆŸç³»ç»Ÿã€‚

{% hint style="info" %}
1ã€ç”±äºæ–¹èˆŸç³»ç»Ÿæ˜¯å…·æœ‰å¹³å°æˆå‘˜å’Œé¡¹ç›®æˆå‘˜ä¸¤çº§æƒé™è®¾è®¡ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡é€šè¿‡OAuth2æˆæƒç™»å½•çš„ç”¨æˆ·ï¼Œä¼šåŒæ­¥ç”¨æˆ·ä¿¡æ¯åˆ°æ–¹èˆŸå¹³å°æƒé™ä½“ç³»ã€‚

2ã€é€šè¿‡OAuth2æˆæƒç™»å½•çš„ç”¨æˆ·ï¼Œéœ€è¦é¡¹ç›®ç®¡ç†å‘˜åœ¨æ–¹èˆŸä¸­å¯¹è¯¥ç”¨æˆ·åˆ†é…ç›¸åº”çš„é¡¹ç›®æƒé™ï¼Œè¿™æ ·è¯¥ç”¨æˆ·å°±èƒ½åœ¨æˆæƒç™»å½•åï¼Œèƒ½å¤Ÿç›´æ¥è®¿é—®æˆæƒçš„é¡¹ç›®ã€‚

3ã€æˆæƒç æ¨¡å¼\(Authentication Code\)æ˜¯OAuth2.0å„ç§è®¤è¯æ¨¡å¼ä¸­åŠŸèƒ½æœ€å®Œæ•´ã€æµç¨‹æœ€ä¸¥å¯†çš„æˆæƒæ¨¡å¼

å…·ä½“ä¿¡æ¯å¯ä»¥å‚è€ƒæ–‡æ¡£ï¼š[æ˜“è§‚æ–¹èˆŸ-å¹³å°ç®¡ç†](../../features/enterprise-management/)
{% endhint %}

## 1. é…ç½®æ­¥éª¤

æ–¹èˆŸæ¥å…¥OAuth2æœåŠ¡è®¤è¯ï¼Œæ ¹æ®æ–¹èˆŸéƒ¨ç½²æƒ…å†µï¼ˆæ˜¯å…¨æ–°éƒ¨ç½²è¿˜æ˜¯å‡çº§åˆ°5.0\)å­˜åœ¨ä¸¤ç§æƒ…å†µï¼Œé…ç½®æ­¥éª¤ä¸Šéƒ¨åˆ†å·®å¼‚ï¼š

1. [å…¨æ–°éƒ¨ç½²çš„5.0 åŠä»¥ä¸Šç‰ˆæœ¬](oauth2.md#11-quan-xin-bu-shu-5-0-yi-shang-ban-ben-de-pei-zhi-bu-zhou)
2. [ä»ä½ç‰ˆæœ¬å‡çº§åˆ°5.0 åŠä»¥ä¸Š](oauth2.md#12-sheng-ji-bu-shu-5-0-yi-shang-ban-ben-de-pei-zhi-bu-zhou)

### 1.1 å…¨æ–°éƒ¨ç½²5.0+ç‰ˆæœ¬çš„é…ç½®æ­¥éª¤

1ï¼‰æ‰“å¼€`Ambari`ç®¡ç†å¹³å°ç™»å½•ï¼ˆhttp://{ARK1\_HOST}:8080/ï¼Œå…·ä½“åœ°å€è¯·è”ç³»æ–¹èˆŸé¡¹ç›®ç»ç†ï¼‰

![armbar&#x767B;&#x5F55;&#x754C;&#x9762;](../../.gitbook/assets/image%20%28363%29.png)

2ï¼‰æ‰“å¼€æ–¹èˆŸåº”ç”¨æœåŠ¡ `Ark Web` å‚æ•°é…ç½®ä¸­å¿ƒï¼š

ç™»å½•åï¼Œåœ¨`Ambari`ä¸»ç•Œé¢ï¼Œå·¦ä¾§æœåŠ¡åˆ—è¡¨ä¸­ï¼Œæ‰¾åˆ° `Ark Web`æœåŠ¡ï¼Œç‚¹å‡»è¿›å…¥ï¼Œåœ¨å³ä¾§å†…å®¹é¡µï¼Œé€‰æ‹©`Configs` æ ‡ç­¾å¡ï¼Œæœ€åç‚¹å¼€ `Advanced ark-web-app-api-server` å‚æ•°é…ç½®é¡¹ï¼Œæ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![ark web &#x914D;&#x7F6E;&#x9875;&#x9762;](../../.gitbook/assets/image%20%28378%29.png)

3ï¼‰å¡«å†™OAuth2 å‚æ•°é…ç½®é¡¹ï¼Œä¿å­˜ä¿®æ”¹å¥½çš„å‚æ•°

ä¸‹æ»‘é¡µé¢ï¼Œåœ¨`Advanced ark-web-app-api-server`çš„ç±»åˆ«ä¸‹æ‰¾åˆ°`arkweb.oauth2` å’Œ `security.oauth2` å¼€å¤´çš„å‚æ•°ï¼ŒæŒ‰ç…§OAuth2æœåŠ¡ç«¯æƒ…å†µå¡«å†™æ­£ç¡®çš„OAuth2æ¥å…¥é…ç½®ï¼Œç¡®ä¿é…ç½®æ— è¯¯åï¼Œç‚¹å‡»å³ä¸Šè§’ `Save`æŒ‰é’®è¿›è¡Œä¿å­˜ã€‚æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š

![](../../.gitbook/assets/image%20%28376%29.png)

_å¤‡æ³¨ï¼šå›¾ç¤ºä¸­çš„é…ç½®é¡¹å·²æœ‰éƒ¨åˆ†å˜æ›´ï¼Œæ‰€æœ‰é…ç½®é¡¹ä»¥ç¬¬äºŒèŠ‚ ã€Šé…ç½®é¡¹è¯´æ˜è¡¨æ ¼ã€‹ä¸ºå‡†_

4ï¼‰é‡å¯æ–¹èˆŸ`Ark Web` æœåŠ¡ï¼Œå¯åŠ¨OAuth2ç¬¬ä¸‰æ–¹ç™»å½•

ç¡®è®¤OAuth2å‚æ•°é…ç½®æ­£ç¡®é…ç½®å’Œä¿å­˜åï¼Œé‡å¯`Ark Web` æœåŠ¡ï¼Œä½¿OAuth2ç¬¬ä¸‰æ–¹ç™»å½•é…ç½®ç”Ÿæ•ˆã€‚æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š

![](../../.gitbook/assets/image%20%28374%29.png)

### 1.2 å‡çº§éƒ¨ç½²5.0+ç‰ˆæœ¬çš„é…ç½®æ­¥éª¤

è‹¥ä»5.0 ä»¥ä¸‹ç‰ˆæœ¬å‡çº§ä¸Šæ¥çš„ï¼Œåœ¨`Ambari`å‚æ•°é…ç½®ä¸­å¿ƒçš„`Advanced ark-web-app-api-server`ç±»åˆ«ä¸­æ˜¯æ‰¾ä¸åˆ°OAuth2ç›¸å…³é…ç½®é¡¹ï¼Œè¿™æ—¶å€™éœ€è¦æ‰‹åŠ¨åœ¨`Custom ark-web-app-api-server` ä¸­æ·»åŠ  é…ç½®é¡¹ï¼Œå³å¯ç”Ÿæ•ˆï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š

1ï¼‰æ‰“å¼€è‡ªå®šä¹‰å‚æ•°é…ç½®ä¸­å¿ƒï¼Œæ·»åŠ è‡ªå®šä¹‰å±æ€§

åœ¨`Ambari`ä¸»ç•Œé¢ï¼Œå·¦ä¾§æœåŠ¡åˆ—è¡¨ä¸­ï¼Œæ‰¾åˆ° `Ark Web`æœåŠ¡ï¼Œç‚¹å‡»è¿›å…¥ï¼Œåœ¨å³ä¾§å†…å®¹é¡µï¼Œé€‰æ‹©`Configs` æ ‡ç­¾å¡ï¼Œæœ€åç‚¹å¼€ `Custom ark-web-app-api-server` å‚æ•°é…ç½®é¡¹ï¼Œç‚¹å‡» `Add Property`ï¼Œæ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](../../.gitbook/assets/image%20%28364%29.png)

2ï¼‰æ·»åŠ OAuth2é…ç½®å‚æ•°

åœ¨å¼¹å‡ºçš„æµ®çª—ä¸­ï¼Œå¯ä»¥æ‰¹é‡æ·»åŠ å‚æ•°é…ç½®ï¼Œä¸€è¡Œå¯¹åº”ä¸€ä¸ªå‚æ•°è®¾ç½®ï¼Œå‚æ•°é…ç½®å¯ä»¥å¤åˆ¶ï¼š

```text
# è¯·æ ¹æ®OAuth2æœåŠ¡å™¨æƒ…å†µå˜æ›´ä»¥ä¸‹å‚æ•°
arkweb.oauth2.enable=true
arkweb.oauth2.url.base_url=http://ark2:4005
arkweb.oauth2.user_info.name_key=preferred_username
security.oauth2.client.scope=all
security.oauth2.client.client_id=abcd1234
security.oauth2.client.client_secret=XYZ1234
security.oauth2.resource.user-info-uri=https://api.github.com/user
security.oauth2.client.access-token-uri=https://github.com/login/oauth/access_token
security.oauth2.client.user-authorization-uri=https://github.com/login/oauth/authorize
```

æ“ä½œæ­¥éª¤å¦‚ä¸‹å›¾ï¼š

![](../../.gitbook/assets/image%20%28365%29.png)

3ï¼‰ä¿å­˜é…ç½®é¡¹

å†æ¬¡æ£€æŸ¥å‚æ•°æ˜¯å¦æ­£ç¡®é…ç½®ï¼Œå¦‚æœé…ç½®é”™è¯¯ ï¼Œåœ¨ä¸‹é¢é¡µé¢ä¹Ÿæ˜¯å¯ä»¥è¿›è¡Œä¿®æ”¹ï¼Œç¡®è®¤æ— è¯¯ï¼Œä¸€å®šè¦è®°å¾—ç‚¹å‡»å³ä¸Šè§’`Save`æŒ‰é’®è¿›è¡Œä¿å­˜ã€‚æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š

![](../../.gitbook/assets/image%20%28373%29.png)

4ï¼‰ä¿å­˜åï¼Œé‡å¯æ–¹èˆŸ`Ark Web` æœåŠ¡

ç¡®è®¤OAuth2å‚æ•°é…ç½®æ­£ç¡®é…ç½®å’Œä¿å­˜åï¼Œé‡å¯`Ark Web` æœåŠ¡ï¼Œä½¿OAuth2ç¬¬ä¸‰æ–¹ç™»å½•é…ç½®ç”Ÿæ•ˆã€‚æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š

![](../../.gitbook/assets/image%20%28370%29.png)

## 2. é…ç½®é¡¹è¯´æ˜

| **å‚æ•°** | æ˜¯å¦å¿…å¡« | å‚æ•°è¯´æ˜ |
| :--- | :--- | :--- |
| arkweb.oauth2.enable | Y | æ˜¯å¦å¼€å¯OAuth2è®¤è¯ï¼Œå¼€å¯åˆ™éœ€è¦è®¾ç½®ä¸ºtrueï¼Œé»˜è®¤ä¸ºfalse |
| arkweb.oauth2.url.base\_url | Y | æ–¹èˆŸäº§å“ä¸»é¡µçš„ æ ¹åŸŸå |
| arkweb.oauth2.user\_info.name\_key | N | åœ¨è·å–ç”¨æˆ·ä¿¡æ¯ä¸­ï¼Œä½¿ç”¨å“ªä¸ªå±æ€§ä½œä¸ºæ–¹èˆŸç”¨æˆ·å¿…éœ€usernameã€‚ é»˜è®¤ä¸ºï¼špreferred\_username |
| security.oauth2.client.scope | Y | è·å–ç”¨æˆ·ä¿¡æ¯éœ€è¦çš„æƒé™åˆ—è¡¨ |
| security.oauth2.client.client\_id | Y | OAuth 2.0 æœåŠ¡ç«¯ä¸ºæ–¹èˆŸæˆæƒç™»å½•é…ç½®çš„å®¢æˆ·ç«¯ID |
| security.oauth2.client.client\_secret | Y | OAuth 2.0 æœåŠ¡ç«¯ä¸ºæ–¹èˆŸæˆæƒç™»å½•é…ç½®çš„å®¢æˆ·ç«¯å¯†é’¥ |
| security.oauth2.resource.user-info-uri | Y | OAuth 2.0 è·å–è¯¥ç”¨æˆ·ä¿¡æ¯çš„æ¥å£åœ°å€ |
| security.oauth2.client.access-token-uri | Y | OAuth 2.0 è·å– Access Token çš„åœ°å€ |
| security.oauth2.client.user-authorization-uri | Y | OAuth 2.0 çš„æˆæƒåœ°å€ |

{% hint style="info" %}
ä»¥ä¸Šå†…å®¹æ²¡æœ‰è§£ç­”æˆ‘çš„é—®é¢˜ï¼Ÿ[ç‚¹å‡»æˆ‘è¿›å…¥æ–¹èˆŸè®ºå›å»åé¦ˆ](https://www.analysysdata.com/forum/index) ğŸš€
{% endhint %}

