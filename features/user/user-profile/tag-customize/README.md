---
description: 通过自定义方式，实现标签加工
---

# 标签加工

![](../../../../.gitbook/assets/image%20%28334%29.png)

提供四种可视化的方式帮助企业创建用户标签，具体可根据不同标签的形式和需求选择创建的方式。在选择任意一种方式进行标签创建之前，支持需要配置标签相关的命名、所属分类、计算周期、到期日期、权限、标签说明等基础属性。

![](../../../../.gitbook/assets/image%20%28624%29.png)

其中，计算周期支持单次执行和周期执行两种，对于临时性的标签可以保存为单次执行，创建完成后立即开始执行，后续不再进行更新。而周期执行则可以选择执行的周期，支持每日、每周、每月三种周期类型。周期执行标签创建完成后同样会立即进行执行，后续将按照每日、每周一、每月一号凌晨0点开始进行周期执行。

{% hint style="info" %}
周期执行标签将默认保存最近6个月的执行结果
{% endhint %}

## 1 自定义取值标签

当完成标签的基础信息配置之后，进入自定义取值标签的规则配置界面。在此标签创建方式中，用户可以自己指定标签的取值，然后针对每一个取值配置具体的标签规则。当用户满足某一个规则将给用户打上对应的标签值，自定义取值标签的标签值均为字符型。

![](../../../../.gitbook/assets/image%20%28315%29.png)

支持通过用户属性、用户行为和已创建的用户分群组合条件进行规则配置，支持多个条件块进行逻辑组合，条件块内各条件之间均为且的关系，条件块之间支持且、或、非的关系。

其中用户属性包含已上报的用户基本属性和已经创建的标签体系，均可作为用户属性条件进行标签计算。

{% hint style="info" %}
当用户同时满足指定的多个标签值条件时，系统默认按照从左到右的顺序，给用户赋予第一个满足的规则的标签值。
{% endhint %}

完成规则配置之后，可点击预览，查看当前时间节点满足条件的用户统计，判断具体标签规则的设置是否符合认知分布，如出现较大的偏差需要进行规则调整重新进行预览。最后点击完成，开始执行标签计算。

![](../../../../.gitbook/assets/image%20%28341%29.png)





## 2 指标标签

指标标签，即将用户发生行为的相关指标统计作为标签值。如用户的购买次数、用户母婴产品的购买总金额等等，指标标签的标签值均为数值型。

![](../../../../.gitbook/assets/image%20%28307%29.png)

统计指标标签支持将选定的某一个行为事件的总次数；数值型事件属性的最大值、最小值、平均值、总和、排重数；字符型事件属性排重值作为标签值。

指标标签预览可以按照默认区间、自定义区间以及离散数字的方式展示统计结果。

![](../../../../.gitbook/assets/image%20%28320%29.png)

## 3 偏好标签

偏好标签则为将用户发生某个事件行为时，出现次数最多的前几个事件属性作为标签值（如购买次数最多的3个商品、登录次数最多的平台）；或将发生该事件时某个数值型属性取值最大、或者最小的几个其他事件属性值作为标签（如购买金额最大的3个商品、支付时间最久的1个商户等）。偏好类标签均以集合类型进行保存。

通过将用户在某些行为发生时的属性特征进行提取，从而展现用户在某些方面的偏好。

![](../../../../.gitbook/assets/image%20%28332%29.png)

偏好标签预览将按照拆分分组进行统计，展示每个拆分属性的统计值。

![](../../../../.gitbook/assets/image%20%28290%29.png)

## 4 SQL自定义标签

除以上三类标签自定义加工方式之外，系统提供自定义SQL脚本的形式进行标签加工。

![](../../../../.gitbook/assets/image%20%28327%29.png)

### 标签值类型

在创建sql标签时，首先需要选择通过sql查询返回的标签值类型。当前支持返回字符、数值、集合、时间四种类型。

| 数据类型 | JSON类型                 | 说明 | 示例 |
| :--- | :--- | :--- | :--- |
| 字符 | string | 使用UTF-8编码后最大长度1024字节 | "智能画像" |
| 数值 | number | -9E14到9E14, 小数点后最多保留3位 | 123 或者123.12 |
| 日期 | datetime | 格式：yyyy-MM-dd HH:mm:ss.SSS 或yyyy-MM-dd HH:mm:ss 或yyyy-mm-dd | "2018-06-18 18:18:18.188" |
| 集合 | array | 元素为字符串，去重后最大元素个数 100，其中每个元素使用 UTF-8 编码后最大长度 255字节；是去重的无序的字符串集合，输入可有重复，导入过程中会去重 | \[ "写作","摄影","烹饪" \] |

选择指定的标签类型后，在SQL编辑框内完成计算SQL，然后点击预览查看标签计算情况，最后保存为标签即可。

有关自定义SQL标签的详细介绍及应用样例请参考《[如何自定义SQL创建标签](sql-customize.md)》。



